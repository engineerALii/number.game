<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø© ---
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ---
        let currentUser = null;
        let currentRoomId = null;
        let currentPlayerName = "";
        let roomUnsubscribe = null;
        let audioContext = null;

        // --- Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ---
        const screens = {
            login: document.getElementById('login-screen'),
            lobby: document.getElementById('lobby-screen'),
            game: document.getElementById('game-screen')
        };

        // --- Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚ ---
        async function initApp() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth Error:", error);
                // alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±"); // Suppress initial alerts to avoid spam
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                showScreen('login');
            }
        });

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª ---
        function showScreen(screenName) {
            Object.values(screens).forEach(el => el.classList.add('hidden'));
            screens[screenName].classList.remove('hidden');
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØª (Web Audio API) ---
        function playSound(type) {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);

            const now = audioContext.currentTime;
            
            if (type === 'flip') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'correct') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now); // A4
                osc.frequency.setValueAtTime(554, now + 0.1); // C#5
                osc.frequency.setValueAtTime(659, now + 0.2); // E5
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'win') {
                // Ù†ØºÙ…Ø© ÙÙˆØ² Ø¨Ø³ÙŠØ·Ø©
                osc.type = 'square';
                osc.frequency.setValueAtTime(523, now);
                osc.frequency.setValueAtTime(659, now + 0.2);
                osc.frequency.setValueAtTime(784, now + 0.4);
                osc.frequency.setValueAtTime(1046, now + 0.6);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 1.5);
                osc.start(now);
                osc.stop(now + 1.5);
            }
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---

        window.createRoom = async () => {
            const nameInput = document.getElementById('player-name').value.trim();
            const roomInput = document.getElementById('room-code').value.trim();

            if (!nameInput || !roomInput) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©");
                return;
            }

            currentPlayerName = nameInput;
            currentRoomId = roomInput;
            // FIX: Added 'rooms' collection segment to make path valid (6 segments)
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', `room_${currentRoomId}`);

            // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ù„Ø© Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ø¹Ø¨Ø©
            // Ø®Ù„Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† 1 Ø¥Ù„Ù‰ 10
            const cards = Array.from({length: 10}, (_, i) => i + 1).sort(() => Math.random() - 0.5);

            const initialData = {
                roomId: currentRoomId,
                status: 'waiting', // waiting, playing, won
                players: [{
                    uid: currentUser.uid,
                    name: currentPlayerName,
                    score: 0,
                    isHost: true
                }],
                cards: cards, // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                revealedMap: {}, // Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© (index -> boolean)
                nextNumber: 1, // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ù„ØªØ§Ù„ÙŠ
                currentTurnIndex: 0,
                winner: null,
                lastAction: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©',
                chat: []
            };

            await setDoc(roomRef, initialData);
            subscribeToRoom();
        };

        window.joinRoom = async () => {
            const nameInput = document.getElementById('player-name').value.trim();
            const roomInput = document.getElementById('room-code').value.trim();

            if (!nameInput || !roomInput) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©");
                return;
            }

            currentPlayerName = nameInput;
            currentRoomId = roomInput;
            // FIX: Added 'rooms' collection segment
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', `room_${currentRoomId}`);
            const roomSnap = await getDoc(roomRef);

            if (!roomSnap.exists()) {
                alert("Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
                return;
            }

            const roomData = roomSnap.data();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„
            const playerExists = roomData.players.some(p => p.uid === currentUser.uid);
            
            if (!playerExists) {
                const newPlayer = {
                    uid: currentUser.uid,
                    name: currentPlayerName,
                    score: 0,
                    isHost: false
                };
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
                const updatedPlayers = [...roomData.players, newPlayer];
                await updateDoc(roomRef, { players: updatedPlayers });
            }

            subscribeToRoom();
        };

        function subscribeToRoom() {
            if (roomUnsubscribe) roomUnsubscribe();

            // FIX: Added 'rooms' collection segment
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', `room_${currentRoomId}`);
            
            roomUnsubscribe = onSnapshot(roomRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    renderGame(data);
                    
                    if (data.status === 'waiting') {
                        showScreen('lobby');
                        updateLobbyUI(data);
                    } else {
                        showScreen('game');
                    }
                }
            }, (error) => {
                console.error("Error watching room:", error);
            });
        }

        window.startGame = async () => {
             // FIX: Added 'rooms' collection segment
             const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', `room_${currentRoomId}`);
             // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
             const cards = Array.from({length: 10}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
             
             await updateDoc(roomRef, {
                 status: 'playing',
                 cards: cards,
                 revealedMap: {},
                 nextNumber: 1,
                 currentTurnIndex: 0,
                 winner: null,
                 lastAction: 'Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø¬Ø¯ Ø§Ù„Ø±Ù‚Ù… 1'
             });
        };
        
        window.resetGame = async () => {
             // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
             window.startGame();
        };

        // --- ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ---

        function updateLobbyUI(data) {
            const list = document.getElementById('lobby-players-list');
            list.innerHTML = '';
            data.players.forEach(p => {
                const li = document.createElement('li');
                li.className = "flex items-center justify-between bg-slate-700 p-3 rounded-lg mb-2";
                li.innerHTML = `
                    <span class="text-white font-bold"><i class="fas fa-user ml-2"></i>${p.name}</span>
                    ${p.isHost ? '<span class="text-yellow-400 text-xs bg-yellow-900 px-2 py-1 rounded">Ù…Ø¶ÙŠÙ</span>' : ''}
                `;
                list.appendChild(li);
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ ÙÙ‚Ø· Ù„Ù„Ù…Ø¶ÙŠÙ
            const isHost = data.players.find(p => p.uid === currentUser.uid)?.isHost;
            const startBtn = document.getElementById('start-game-btn');
            if (isHost) {
                startBtn.classList.remove('hidden');
            } else {
                startBtn.classList.add('hidden');
                document.getElementById('lobby-status').innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...";
            }
        }

        function renderGame(data) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
            document.getElementById('room-id-display').innerText = `ØºØ±ÙØ©: ${data.roomId}`;
            const currentPlayer = data.players[data.currentTurnIndex];
            const isMyTurn = currentPlayer?.uid === currentUser.uid;
            
            const turnIndicator = document.getElementById('turn-indicator');
            const turnText = document.getElementById('turn-text');
            
            if (data.winner) {
                turnIndicator.className = "mb-6 p-4 rounded-xl bg-green-600 text-center shadow-lg transform scale-105 transition-all";
                turnText.innerHTML = `<i class="fas fa-trophy text-yellow-300 text-2xl mb-1 block"></i> Ø§Ù„ÙØ§Ø¦Ø²: ${data.winner}`;
                if (data.status !== 'won') playSound('win'); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù†Ø¸Ø±ÙŠØ§Ù‹
            } else {
                turnText.innerHTML = isMyTurn ? 
                    `<span class="text-green-300 font-bold">Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†!</span> Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ù‚Ù… ${data.nextNumber}` : 
                    `Ø¯ÙˆØ±: <span class="font-bold text-yellow-300">${currentPlayer?.name}</span> (ÙŠØ¨Ø­Ø« Ø¹Ù† ${data.nextNumber})`;
                
                turnIndicator.className = isMyTurn ? 
                    "mb-6 p-4 rounded-xl bg-indigo-600 border-2 border-green-400 text-center shadow-lg transform scale-105 transition-all" : 
                    "mb-6 p-4 rounded-xl bg-slate-700 text-center shadow-md transition-all";
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª
            if (data.status === 'won') {
                 document.getElementById('reset-game-area').classList.remove('hidden');
            } else {
                 document.getElementById('reset-game-area').classList.add('hidden');
            }

            // Ø±Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ©
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';

            data.cards.forEach((cardValue, index) => {
                const isRevealed = data.revealedMap[index] === true;
                const cardEl = document.createElement('div');
                // ÙØ¦Ø§Øª Tailwind Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„Ø¨
                cardEl.className = `relative w-full h-24 sm:h-32 cursor-pointer perspective-1000 group`;
                
                // Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¯ÙˆØ±
                const inner = document.createElement('div');
                inner.className = `relative w-full h-full duration-500 transform-style-3d transition-transform ${isRevealed ? 'rotate-y-180' : ''}`;
                
                // Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ (Ø§Ù„Ù…Ø®ÙÙŠ)
                const front = document.createElement('div');
                front.className = "absolute w-full h-full backface-hidden bg-slate-600 rounded-xl shadow-lg border-b-4 border-slate-800 flex items-center justify-center hover:bg-slate-500 transition-colors";
                front.innerHTML = `<i class="fas fa-question text-3xl text-slate-400"></i>`;
                
                // Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ (Ø§Ù„Ø±Ù‚Ù…)
                const back = document.createElement('div');
                back.className = "absolute w-full h-full backface-hidden bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl shadow-lg border-b-4 border-indigo-800 flex items-center justify-center rotate-y-180";
                back.innerHTML = `<span class="text-4xl font-bold text-white drop-shadow-md">${cardValue}</span>`;
                
                inner.appendChild(front);
                inner.appendChild(back);
                cardEl.appendChild(inner);

                // Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø±
                cardEl.onclick = () => handleCardClick(index, cardValue, isRevealed, isMyTurn, data);

                grid.appendChild(cardEl);
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
            renderChat(data.chat);
        }

        async function handleCardClick(index, value, isRevealed, isMyTurn, data) {
            if (!isMyTurn || isRevealed || data.status === 'won') return;

            playSound('flip');
            // FIX: Added 'rooms' collection segment
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', `room_${currentRoomId}`);
            
            let updates = {};
            let nextNum = data.nextNumber;
            let nextTurn = data.currentTurnIndex;
            let status = data.status;
            let winner = data.winner;
            let revealed = { ...data.revealedMap };
            let actionMsg = "";

            if (value === nextNum) {
                // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                playSound('correct');
                revealed[index] = true;
                nextNum++;
                actionMsg = `${currentUser.displayName || currentPlayerName} ÙˆØ¬Ø¯ Ø§Ù„Ø±Ù‚Ù… ${value}!`;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙˆØ²
                if (nextNum > 10) {
                    status = 'won';
                    winner = currentPlayerName;
                    playSound('win');
                    actionMsg = `ğŸ‰ ${currentPlayerName} ÙØ§Ø² Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©!`;
                }
            } else {
                // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                playSound('wrong');
                // Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯: Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£ØŒ ØªØºÙ„Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª!
                revealed = {}; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒØ§Ù…Ù„Ø©
                nextNum = 1; // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ù‚Ù… 1
                
                // Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø¯ÙˆØ±
                nextTurn = (data.currentTurnIndex + 1) % data.players.length;
                actionMsg = `âŒ ${currentPlayerName} Ø£Ø®Ø·Ø£ (Ø§Ø®ØªØ§Ø± ${value})! ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª.`;
            }

            updates = {
                revealedMap: revealed,
                nextNumber: nextNum,
                currentTurnIndex: nextTurn,
                status: status,
                winner: winner,
                lastAction: actionMsg
            };

            await updateDoc(roomRef, updates);
        }

        // --- Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ---
        
        window.sendChat = async () => {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (!msg) return;

            // FIX: Added 'rooms' collection segment
            const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', `room_${currentRoomId}`);
            const newMsg = {
                sender: currentPlayerName,
                text: msg,
                time: Date.now()
            };

            await updateDoc(roomRef, {
                chat: arrayUnion(newMsg)
            });
            input.value = '';
        };

        function renderChat(chatData) {
            const chatBox = document.getElementById('chat-messages');
            chatBox.innerHTML = '';
            if(!chatData) return;

            chatData.forEach(msg => {
                const isMe = msg.sender === currentPlayerName;
                const div = document.createElement('div');
                div.className = `mb-2 flex ${isMe ? 'justify-end' : 'justify-start'}`;
                div.innerHTML = `
                    <div class="${isMe ? 'bg-indigo-600 text-white' : 'bg-slate-700 text-gray-200'} px-3 py-2 rounded-lg max-w-[80%] text-sm shadow">
                        <div class="text-xs opacity-75 mb-1 font-bold">${msg.sender}</div>
                        ${msg.text}
                    </div>
                `;
                chatBox.appendChild(div);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        initApp();
    </script>

    <style>
        /* CSS Ø¥Ø¶Ø§ÙÙŠ Ù„ØªØ¹Ø²ÙŠØ² Tailwind */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col overflow-hidden">

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-screen" class="flex-grow flex items-center justify-center p-4 relative overflow-hidden">
        <!-- Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø¨Ø³ÙŠØ·Ø© -->
        <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
            <div class="absolute top-10 left-10 text-9xl animate-bounce">?</div>
            <div class="absolute bottom-20 right-20 text-9xl animate-pulse">1</div>
            <div class="absolute top-1/2 left-1/2 text-9xl animate-spin">5</div>
        </div>

        <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-700 z-10">
            <h1 class="text-3xl font-bold text-center mb-2 text-indigo-400">Memory Sequence</h1>
            <p class="text-slate-400 text-center mb-8">Ø±ØªØ¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…ØŒ ØªØ°ÙƒØ± Ø§Ù„Ø£Ù…Ø§ÙƒÙ†ØŒ Ø§Ù‡Ø²Ù… Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ!</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-300">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</label>
                    <input type="text" id="player-name" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ...">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-300">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</label>
                    <input type="text" id="room-code" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="Ù…Ø«Ø§Ù„: 1234">
                </div>
                
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button onclick="createRoom()" class="bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-bold transition-all transform hover:scale-105 shadow-lg shadow-indigo-500/30">
                        <i class="fas fa-plus-circle ml-2"></i>Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©
                    </button>
                    <button onclick="joinRoom()" class="bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg font-bold transition-all transform hover:scale-105">
                        <i class="fas fa-sign-in-alt ml-2"></i>Ø§Ù†Ø¶Ù…Ø§Ù…
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Lobby) -->
    <div id="lobby-screen" class="hidden flex-grow flex items-center justify-center p-4">
        <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-lg border border-slate-700">
            <h2 class="text-2xl font-bold mb-4 text-center border-b border-slate-700 pb-4">ØºØ±ÙØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h2>
            <div id="lobby-status" class="text-center text-slate-400 mb-4 animate-pulse">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...</div>
            
            <ul id="lobby-players-list" class="mb-8 max-h-60 overflow-y-auto">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </ul>

            <button id="start-game-btn" onclick="startGame()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-bold text-lg shadow-lg shadow-green-500/30 transition-all hidden">
                Ø§Ø¨Ù€Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ù€Ø© Ø§Ù„Ø¢Ù†!
            </button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="game-screen" class="hidden flex-grow flex flex-col md:flex-row h-screen">
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ (ÙŠØ³Ø§Ø±/Ø£Ø¹Ù„Ù‰) -->
        <div class="flex-grow p-4 md:p-8 flex flex-col items-center justify-center bg-slate-900 overflow-y-auto">
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØºØ±ÙØ© ÙˆØ§Ù„Ø¯ÙˆØ± -->
            <div class="w-full max-w-2xl mb-4 flex justify-between items-center text-sm text-slate-400">
                <span id="room-id-display"></span>
                <button onclick="location.reload()" class="hover:text-red-400"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</button>
            </div>

            <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø¯ÙˆØ± -->
            <div id="turn-indicator" class="w-full max-w-2xl">
                <h2 id="turn-text" class="text-xl md:text-2xl">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
            </div>
            
             <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ (ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„ÙÙˆØ²) -->
            <div id="reset-game-area" class="hidden mb-4 w-full max-w-2xl text-center">
                <button onclick="resetGame()" class="bg-indigo-600 hover:bg-indigo-500 px-6 py-2 rounded-full font-bold shadow-lg animate-bounce">
                    <i class="fas fa-redo ml-2"></i> Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                </button>
            </div>

            <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
            <div id="game-grid" class="grid grid-cols-3 sm:grid-cols-4 gap-3 sm:gap-4 w-full max-w-2xl">
                <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ØªÙˆÙ„Ø¯ Ù‡Ù†Ø§ -->
            </div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (ÙŠÙ…ÙŠÙ†/Ø£Ø³ÙÙ„) -->
        <div class="w-full md:w-80 bg-slate-800 border-t md:border-t-0 md:border-r border-slate-700 flex flex-col h-1/3 md:h-full shadow-2xl z-20">
            <div class="p-3 bg-slate-900 border-b border-slate-700 font-bold flex items-center">
                <i class="fas fa-comments ml-2 text-indigo-400"></i> Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
            </div>
            
            <div id="chat-messages" class="flex-grow p-3 overflow-y-auto space-y-2 bg-slate-800/50">
                <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            </div>

            <div class="p-3 bg-slate-900 border-t border-slate-700">
                <div class="flex gap-2">
                    <input type="text" id="chat-input" 
                           class="flex-grow bg-slate-800 border border-slate-600 rounded-full px-4 py-2 text-sm focus:outline-none focus:border-indigo-500"
                           placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..."
                           onkeypress="if(event.key === 'Enter') sendChat()">
                    <button onclick="sendChat()" class="bg-indigo-600 hover:bg-indigo-700 text-white w-10 h-10 rounded-full flex items-center justify-center transition-colors">
                        <i class="fas fa-paper-plane text-sm"></i>
                    </button>
                </div>
                <!-- Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§ÙŠÙ…ÙˆØ¬ÙŠ Ø³Ø±ÙŠØ¹Ø© -->
                <div class="flex gap-2 mt-2 justify-center text-lg">
                    <span class="cursor-pointer hover:scale-125 transition-transform" onclick="document.getElementById('chat-input').value += 'ğŸ˜‚'">ğŸ˜‚</span>
                    <span class="cursor-pointer hover:scale-125 transition-transform" onclick="document.getElementById('chat-input').value += 'ğŸ˜¡'">ğŸ˜¡</span>
                    <span class="cursor-pointer hover:scale-125 transition-transform" onclick="document.getElementById('chat-input').value += 'ğŸ‘'">ğŸ‘</span>
                    <span class="cursor-pointer hover:scale-125 transition-transform" onclick="document.getElementById('chat-input').value += 'ğŸ¤”'">ğŸ¤”</span>
                </div>
            </div>
        </div>

    </div>

</body>
</html>
